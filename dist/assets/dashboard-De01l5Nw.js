import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as O}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getDatabase as L,onValue as x,ref as Y,set as F}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";import{getAuth as R,onAuthStateChanged as j,signInWithEmailAndPassword as V,signOut as z}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";const Q={apiKey:"AIzaSyCjLzq8QNQqhGOpTJy3tzwuQrovMm6Vdi4",authDomain:"unlock-the-lab-workshop.firebaseapp.com",databaseURL:"https://unlock-the-lab-workshop-default-rtdb.europe-west1.firebasedatabase.app",projectId:"unlock-the-lab-workshop",storageBucket:"unlock-the-lab-workshop.firebasestorage.app",messagingSenderId:"604889899913",appId:"1:604889899913:web:d46afe88111e8bcb7d3758",measurementId:"G-VEVYY65K1M"},k=O(Q),b=L(k),A=R(k),g=["STUDY-101","STUDY-102","STUDY-103","STUDY-104","STUDY-105","STUDY-106","STUDY-107","STUDY-108","STUDY-109","STUDY-110","STUDY-111","STUDY-112","STUDY-113","STUDY-114","STUDY-115","STUDY-116","STUDY-117","STUDY-118","STUDY-119","STUDY-120","STUDY-121","STUDY-122","STUDY-123"],W={"STUDY-101":"low","STUDY-102":"medium","STUDY-103":"high","STUDY-104":"low","STUDY-105":"medium","STUDY-106":"medium","STUDY-107":"low","STUDY-108":"high","STUDY-109":"medium","STUDY-110":"high","STUDY-111":"low","STUDY-112":"low","STUDY-113":"high","STUDY-114":"medium","STUDY-115":"low","STUDY-116":"medium","STUDY-117":"low","STUDY-118":"medium","STUDY-119":"high","STUDY-120":"low","STUDY-121":"medium","STUDY-122":"high","STUDY-123":"low"},K={"STUDY-101":1,"STUDY-102":5,"STUDY-103":6,"STUDY-104":1,"STUDY-105":5,"STUDY-106":4,"STUDY-107":2,"STUDY-108":7,"STUDY-109":4,"STUDY-110":6,"STUDY-111":2,"STUDY-112":1,"STUDY-113":6,"STUDY-114":5,"STUDY-115":3,"STUDY-116":5,"STUDY-117":1,"STUDY-118":4,"STUDY-119":7,"STUDY-120":2,"STUDY-121":5,"STUDY-122":6,"STUDY-123":1},G=100;let E,$;const N=document.getElementById("ratingsChart").getContext("2d");E=new Chart(N,{type:"bar",data:{labels:g,datasets:[{label:"Average Rating",data:[],backgroundColor:"rgba(102, 126, 234, 0.8)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:5,title:{display:!0,text:"Rating (1-5)"}}}}});const Z=document.getElementById("agreementChart").getContext("2d");$=new Chart(Z,{type:"bar",data:{labels:g,datasets:[{label:"Standard Deviation",data:[],backgroundColor:"rgba(118, 75, 162, 0.8)",borderColor:"rgba(118, 75, 162, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Std Deviation (lower = higher agreement)"}}}}});function H(t){if(!t||t.length===0)return{mean:0,stdDev:0,min:0,max:0,agreement:0};const n=t.reduce((c,l)=>c+l,0)/t.length,a=t.reduce((c,l)=>c+Math.pow(l-n,2),0)/t.length,o=Math.sqrt(a),r=Math.min(...t),i=Math.max(...t),m=n===0?0:Math.min(100,100*(1-o/n));return{mean:n.toFixed(2),stdDev:o.toFixed(2),min:r.toFixed(1),max:i.toFixed(1),agreement:m.toFixed(0)}}function D(t,n,a,o=!0){const r=(t-n)/(a-n),i=Math.max(0,Math.min(1,r));if(o){const m=Math.round(239-223*i),c=Math.round(68+117*i),l=Math.round(68+61*i);return`rgb(${m}, ${c}, ${l})`}else{const m=Math.round(59+180*i),c=Math.round(130-62*i),l=Math.round(246-178*i);return`rgb(${m}, ${c}, ${l})`}}function I(t,n,a){const o={};let r=0,i=[];g.forEach(s=>{const e=t[s]||{},d=Object.values(e).filter(u=>u!=null).map(u=>u.rating||u),w=K[s]||4,h=[...d,...Array(G).fill(w)];o[s]={...H(h),count:d.length,totalCount:h.length},r+=d.length}),document.getElementById("totalRatings").textContent=r;const m=n?Object.keys(n).filter(s=>{const e=n[s].timestamp;return Date.now()-e<6e4}).length:0;document.getElementById("activeParticipants").textContent=m;const c=a?Object.keys(a).length:0;if(document.getElementById("completedSessions").textContent=c,a){i=Object.values(a).map(e=>e.score||0);const s=i.length>0?(i.reduce((e,d)=>e+d,0)/i.length).toFixed(0):0;document.getElementById("avgScore").textContent=s}E.data.datasets[0].data=g.map(s=>o[s].mean),E.update(),$.data.datasets[0].data=g.map(s=>o[s].stdDev),$.update();const l=document.getElementById("statsTableBody");l.innerHTML=g.map(s=>{const e=o[s],d=W[s],w=d==="high"?"quality-high":d==="medium"?"quality-medium":"quality-low",h=D(e.mean,1,7,!1),u=D(e.stdDev,0,3,!1),v=parseFloat(e.agreement),M=D(v,0,100,!0),P=D(e.count,0,Math.max(...g.map(q=>o[q].count)),!0);return`
                    <tr data-study="${s}" data-quality="${d}" data-responses="${e.count}" 
                        data-mean="${e.mean}" data-stddev="${e.stdDev}" data-min="${e.min}" 
                        data-max="${e.max}" data-agreement="${v}">
                        <td><strong>${s}</strong></td>
                        <td>
                            <span class="quality-indicator ${w}"></span>
                            ${d.charAt(0).toUpperCase()+d.slice(1)}
                        </td>
                        <td class="color-scale" style="background: ${P}; color: ${e.count>5?"white":"#374151"}">${e.count}</td>
                        <td class="color-scale" style="background: ${h}; color: white">${e.mean}</td>
                        <td class="color-scale" style="background: ${u}; color: ${e.stdDev>1.5?"white":"#374151"}">${e.stdDev}</td>
                        <td>${e.min}</td>
                        <td>${e.max}</td>
                        <td class="color-scale" style="background: ${M}; color: ${v>50?"white":"#374151"}">${e.agreement}%</td>
                    </tr>
                `}).join("")}let T={},y={},p={};x(Y(b,"ratings"),t=>{T=t.val()||{},I(T,y,p)});x(Y(b,"active"),t=>{y=t.val()||{},I(T,y,p)});x(Y(b,"leaderboard"),t=>{p=t.val()||{},I(T,y,p)});let U,S=10,f=null;j(A,t=>{f=t,t&&(document.getElementById("adminEmail").textContent=`✅ Signed in as ${t.email}`)});window.openAdminPanel=function(){document.getElementById("adminOverlay").classList.add("active"),f?(document.getElementById("passwordSection").style.display="none",document.getElementById("adminActions").style.display="block"):(document.getElementById("passwordSection").style.display="block",document.getElementById("adminActions").style.display="none",document.getElementById("adminEmail").value="",document.getElementById("adminPassword").value="",document.getElementById("adminEmail").focus(),J())};window.closeAdminPanel=function(t){(!t||t.target.id==="adminOverlay"||t.target.classList.contains("btn-cancel"))&&(document.getElementById("adminOverlay").classList.remove("active"),clearInterval(U),S=10)};function J(){S=10,B(),U=setInterval(()=>{S--,B(),S<=0&&(clearInterval(U),closeAdminPanel({target:{id:"adminOverlay"}}))},1e3)}function B(){const t=document.getElementById("adminTimer");t.textContent=`Time remaining: ${S}s`,S<=3?t.classList.add("warning"):t.classList.remove("warning")}window.handlePasswordKeyPress=function(t){t.key==="Enter"&&verifyPassword()};window.verifyPassword=function(){const t=document.getElementById("adminEmail").value.trim(),n=document.getElementById("adminPassword").value;if(!t||!n){alert("❌ Please enter both email and password");return}const a=document.getElementById("loginBtn");a.disabled=!0,a.textContent="Signing in...",V(A,t,n).then(o=>{clearInterval(U),f=o.user,document.getElementById("passwordSection").style.display="none",document.getElementById("adminActions").style.display="block",document.getElementById("adminTitle").textContent="✅ Admin Panel",a.disabled=!1,a.textContent="Sign In"}).catch(o=>{let r="Authentication failed";o.code==="auth/invalid-credential"||o.code==="auth/wrong-password"||o.code==="auth/user-not-found"?r="Invalid email or password":o.code==="auth/too-many-requests"&&(r="Too many failed attempts. Try again later"),alert("❌ "+r),document.getElementById("adminPassword").value="",a.disabled=!1,a.textContent="Sign In"})};window.adminSignOut=function(){z(A).then(()=>{f=null,closeAdminPanel({target:{id:"adminOverlay"}})}).catch(t=>{alert("❌ Error signing out: "+t.message)})};window.endAllSessions=function(){const t=Object.keys(y).length;if(t===0){alert("ℹ️ No active sessions to end");return}if(confirm(`⚠️ This will end ${t} active session(s).

Are you sure you want to continue?`)){const n=document.getElementById("endSessionsBtn");n.disabled=!0,n.textContent="Ending sessions...",F(Y(b,"active"),null).then(()=>{alert(`✅ Successfully ended ${t} session(s)`),n.disabled=!1,n.textContent="⏹️ End All Active Sessions",closeAdminPanel({target:{id:"adminOverlay"}})}).catch(a=>{alert("❌ Error ending sessions: "+a.message),n.disabled=!1,n.textContent="⏹️ End All Active Sessions"})}};let C={column:-1,ascending:!0};window.sortTable=function(t,n){const a=document.getElementById("statsTable"),o=a.querySelector("tbody"),r=Array.from(o.querySelectorAll("tr")),i=C.column===t?!C.ascending:!0;C={column:t,ascending:i},a.querySelectorAll("th").forEach((l,s)=>{l.classList.remove("sort-asc","sort-desc"),s===t&&l.classList.add(i?"sort-asc":"sort-desc")});const c=["study","quality","responses","mean","stddev","min","max","agreement"][t];r.sort((l,s)=>{let e=l.dataset[c],d=s.dataset[c];return n==="number"?(e=parseFloat(e),d=parseFloat(d)):(e=e.toLowerCase(),d=d.toLowerCase()),e<d?i?-1:1:e>d?i?1:-1:0}),r.forEach(l=>o.appendChild(l))};
