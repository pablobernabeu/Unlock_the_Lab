import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as O}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getDatabase as R,onValue as B,ref as Y,set as V}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";import{getAuth as j,onAuthStateChanged as z,signInWithEmailAndPassword as Q,signOut as W}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";const H={apiKey:"AIzaSyCjLzq8QNQqhGOpTJy3tzwuQrovMm6Vdi4",authDomain:"unlock-the-lab-workshop.firebaseapp.com",databaseURL:"https://unlock-the-lab-workshop-default-rtdb.europe-west1.firebasedatabase.app",projectId:"unlock-the-lab-workshop",storageBucket:"unlock-the-lab-workshop.firebasestorage.app",messagingSenderId:"604889899913",appId:"1:604889899913:web:d46afe88111e8bcb7d3758",measurementId:"G-VEVYY65K1M"},A=O(H),v=R(A),C=j(A),g=["STUDY-101","STUDY-102","STUDY-103","STUDY-104","STUDY-105","STUDY-106","STUDY-107","STUDY-108","STUDY-109","STUDY-110","STUDY-111","STUDY-112","STUDY-113","STUDY-114","STUDY-115","STUDY-116","STUDY-117","STUDY-118","STUDY-119","STUDY-120","STUDY-121","STUDY-122","STUDY-123"],M={"STUDY-101":"low","STUDY-102":"medium","STUDY-103":"high","STUDY-104":"low","STUDY-105":"medium","STUDY-106":"medium","STUDY-107":"low","STUDY-108":"high","STUDY-109":"medium","STUDY-110":"high","STUDY-111":"low","STUDY-112":"low","STUDY-113":"high","STUDY-114":"medium","STUDY-115":"low","STUDY-116":"medium","STUDY-117":"low","STUDY-118":"medium","STUDY-119":"high","STUDY-120":"low","STUDY-121":"medium","STUDY-122":"high","STUDY-123":"low"},G={"STUDY-101":1,"STUDY-102":5,"STUDY-103":6,"STUDY-104":1,"STUDY-105":5,"STUDY-106":4,"STUDY-107":2,"STUDY-108":7,"STUDY-109":4,"STUDY-110":6,"STUDY-111":2,"STUDY-112":1,"STUDY-113":6,"STUDY-114":5,"STUDY-115":3,"STUDY-116":5,"STUDY-117":1,"STUDY-118":4,"STUDY-119":7,"STUDY-120":2,"STUDY-121":5,"STUDY-122":6,"STUDY-123":1},K=100;let T;const N=document.getElementById("ratingsChart").getContext("2d");T=new Chart(N,{type:"bar",data:{labels:g,datasets:[{label:"Average Rating",data:[],backgroundColor:"rgba(102, 126, 234, 0.8)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2,errorBars:{}}]},options:{responsive:!0,maintainAspectRatio:!1,onClick:(t,e)=>{if(e.length>0){const o=e[0].index,n=g[o];showStudyDetails(n)}},scales:{y:{beginAtZero:!0,max:7,title:{display:!0,text:"Rating (1-7 scale)"}},x:{ticks:{callback:function(t,e){return g[e]+" ⓘ"},font:{size:10}}}},plugins:{tooltip:{callbacks:{label:function(t){return`Rating: ${t.parsed.y.toFixed(2)} (click for details)`}}},legend:{display:!1}}},plugins:[{id:"errorBars",afterDatasetsDraw(t){const e=t.ctx,o=t.getDatasetMeta(0),n=t.data.datasets[0].errorBars;o.data.forEach((d,r)=>{if(!n[r])return;const{lower:u,upper:c}=n[r],i=d.x,m=t.scales.y.getPixelForValue(u),s=t.scales.y.getPixelForValue(c);e.save(),e.strokeStyle="rgba(0, 0, 0, 0.8)",e.lineWidth=2,e.beginPath(),e.moveTo(i,m),e.lineTo(i,s),e.stroke(),e.beginPath(),e.moveTo(i-5,m),e.lineTo(i+5,m),e.stroke(),e.beginPath(),e.moveTo(i-5,s),e.lineTo(i+5,s),e.stroke(),e.restore()})}}]});function J(t){if(!t||t.length===0)return{mean:0,stdDev:0,min:0,max:0,agreement:0,ci95Lower:0,ci95Upper:0};const e=t.length,o=t.reduce((l,y)=>l+y,0)/e,n=t.reduce((l,y)=>l+Math.pow(y-o,2),0)/e,d=Math.sqrt(n),r=Math.min(...t),u=Math.max(...t),c=d/Math.sqrt(e),i=1.96,m=Math.max(1,o-i*c),s=Math.min(7,o+i*c),a=o===0?0:Math.min(100,100*(1-d/o));return{mean:o.toFixed(2),stdDev:d.toFixed(2),min:r.toFixed(1),max:u.toFixed(1),agreement:a.toFixed(0),ci95Lower:m.toFixed(2),ci95Upper:s.toFixed(2)}}function f(t,e,o,n=!0){const d=(t-e)/(o-e),r=Math.max(0,Math.min(1,d));if(n){const u=Math.round(239-223*r),c=Math.round(68+117*r),i=Math.round(68+61*r);return`rgb(${u}, ${c}, ${i})`}else{const u=Math.round(59+180*r),c=Math.round(130-62*r),i=Math.round(246-178*r);return`rgb(${u}, ${c}, ${i})`}}function I(t,e,o){const n={};let d=0,r=[];g.forEach(s=>{const a=t[s]||{},l=Object.values(a).filter(p=>p!=null).map(p=>p.rating||p),y=G[s]||4,b=[...l,...Array(K).fill(y)];n[s]={...J(b),count:l.length,totalCount:b.length},d+=l.length}),X(n),document.getElementById("totalRatings").textContent=d;const u=e?Object.keys(e).filter(s=>{const a=e[s].timestamp;return Date.now()-a<6e4}).length:0;document.getElementById("activeParticipants").textContent=u;const c=o?Object.keys(o).length:0;if(document.getElementById("completedSessions").textContent=c,o){r=Object.values(o).map(a=>a.score||0);const s=r.length>0?(r.reduce((a,l)=>a+l,0)/r.length).toFixed(0):0;document.getElementById("avgScore").textContent=s}const i={};g.forEach((s,a)=>{i[a]={lower:parseFloat(n[s].ci95Lower),upper:parseFloat(n[s].ci95Upper)}}),T.data.datasets[0].data=g.map(s=>n[s].mean),T.data.datasets[0].errorBars=i,T.update();const m=document.getElementById("statsTableBody");m.innerHTML=g.map(s=>{const a=n[s],l=M[s],y=l==="high"?"quality-high":l==="medium"?"quality-medium":"quality-low",b=f(a.mean,1,7,!1),p=f(a.stdDev,0,3,!1),E=parseFloat(a.agreement),P=f(E,0,100,!0),q=f(a.count,0,Math.max(...g.map(F=>n[F].count)),!0);return`
                    <tr data-study="${s}" data-quality="${l}" data-responses="${a.count}" 
                        data-mean="${a.mean}" data-stddev="${a.stdDev}" data-min="${a.min}" 
                        data-max="${a.max}" data-agreement="${E}">
                        <td><strong>${s}</strong></td>
                        <td>
                            <span class="quality-indicator ${y}"></span>
                            ${l.charAt(0).toUpperCase()+l.slice(1)}
                        </td>
                        <td class="color-scale" style="background: ${q}; color: ${a.count>5?"white":"#374151"}">${a.count}</td>
                        <td class="color-scale" style="background: ${b}; color: white">${a.mean}</td>
                        <td class="color-scale" style="background: ${p}; color: ${a.stdDev>1.5?"white":"#374151"}">${a.stdDev}</td>
                        <td>${a.min}</td>
                        <td>${a.max}</td>
                        <td class="color-scale" style="background: ${P}; color: ${E>50?"white":"#374151"}">${a.agreement}%</td>
                    </tr>
                `}).join("")}let D={},S={},w={};B(Y(v,"ratings"),t=>{D=t.val()||{},I(D,S,w)});B(Y(v,"active"),t=>{S=t.val()||{},I(D,S,w)});B(Y(v,"leaderboard"),t=>{w=t.val()||{},I(D,S,w)});let U,h=10,x=null;z(C,t=>{x=t,t&&(document.getElementById("adminEmail").textContent=`✅ Signed in as ${t.email}`)});window.openAdminPanel=function(){document.getElementById("adminOverlay").classList.add("active"),x?(document.getElementById("passwordSection").style.display="none",document.getElementById("adminActions").style.display="block"):(document.getElementById("passwordSection").style.display="block",document.getElementById("adminActions").style.display="none",document.getElementById("adminEmail").value="",document.getElementById("adminPassword").value="",document.getElementById("adminEmail").focus(),Z())};window.closeAdminPanel=function(t){(!t||t.target.id==="adminOverlay"||t.target.classList.contains("btn-cancel"))&&(document.getElementById("adminOverlay").classList.remove("active"),clearInterval(U),h=10)};function Z(){h=10,k(),U=setInterval(()=>{h--,k(),h<=0&&(clearInterval(U),closeAdminPanel({target:{id:"adminOverlay"}}))},1e3)}function k(){const t=document.getElementById("adminTimer");t.textContent=`Time remaining: ${h}s`,h<=3?t.classList.add("warning"):t.classList.remove("warning")}window.handlePasswordKeyPress=function(t){t.key==="Enter"&&verifyPassword()};window.verifyPassword=function(){const t=document.getElementById("adminEmail").value.trim(),e=document.getElementById("adminPassword").value;if(!t||!e){alert("❌ Please enter both email and password");return}const o=document.getElementById("loginBtn");o.disabled=!0,o.textContent="Signing in...",Q(C,t,e).then(n=>{clearInterval(U),x=n.user,document.getElementById("passwordSection").style.display="none",document.getElementById("adminActions").style.display="block",document.getElementById("adminTitle").textContent="✅ Admin Panel",o.disabled=!1,o.textContent="Sign In"}).catch(n=>{let d="Authentication failed";n.code==="auth/invalid-credential"||n.code==="auth/wrong-password"||n.code==="auth/user-not-found"?d="Invalid email or password":n.code==="auth/too-many-requests"&&(d="Too many failed attempts. Try again later"),alert("❌ "+d),document.getElementById("adminPassword").value="",o.disabled=!1,o.textContent="Sign In"})};window.adminSignOut=function(){W(C).then(()=>{x=null,closeAdminPanel({target:{id:"adminOverlay"}})}).catch(t=>{alert("❌ Error signing out: "+t.message)})};window.endAllSessions=function(){const t=Object.keys(S).length;if(t===0){alert("ℹ️ No active sessions to end");return}if(confirm(`⚠️ This will end ${t} active session(s).

Are you sure you want to continue?`)){const e=document.getElementById("endSessionsBtn");e.disabled=!0,e.textContent="Ending sessions...",V(Y(v,"active"),null).then(()=>{alert(`✅ Successfully ended ${t} session(s)`),e.disabled=!1,e.textContent="⏹️ End All Active Sessions",closeAdminPanel({target:{id:"adminOverlay"}})}).catch(o=>{alert("❌ Error ending sessions: "+o.message),e.disabled=!1,e.textContent="⏹️ End All Active Sessions"})}};let $={column:-1,ascending:!0};window.sortTable=function(t,e){const o=document.getElementById("statsTable"),n=o.querySelector("tbody"),d=Array.from(n.querySelectorAll("tr")),r=$.column===t?!$.ascending:!0;$={column:t,ascending:r},o.querySelectorAll("th").forEach((i,m)=>{i.classList.remove("sort-asc","sort-desc"),m===t&&i.classList.add(r?"sort-asc":"sort-desc")});const c=["study","quality","responses","mean","stddev","min","max","agreement"][t];d.sort((i,m)=>{let s=i.dataset[c],a=m.dataset[c];return e==="number"?(s=parseFloat(s),a=parseFloat(a)):(s=s.toLowerCase(),a=a.toLowerCase()),s<a?r?-1:1:s>a?r?1:-1:0}),d.forEach(i=>n.appendChild(i))};let L={};window.showStudyDetails=function(t){const e=document.getElementById("studyModal"),o=M[t],n=L[t];if(!n){alert("No data available for this study yet.");return}document.getElementById("studyTitle").textContent=t,document.getElementById("studyQuality").innerHTML=`
                <span style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: ${o==="high"?"#10b981":o==="medium"?"#f59e0b":"#ef4444"}; margin-right: 8px;"></span>
                <strong>Quality Level:</strong> ${o.charAt(0).toUpperCase()+o.slice(1)}
            `,document.getElementById("studyStats").innerHTML=`
                <div style="background: #f9fafb; padding: 1.5rem; border-radius: 8px; margin-top: 1rem;">
                    <h3 style="margin-top: 0; color: #667eea;">Rating Statistics</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 0.75rem; font-weight: 600;">Participants:</td>
                            <td style="padding: 0.75rem;">${n.count}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 0.75rem; font-weight: 600;">Mean Rating:</td>
                            <td style="padding: 0.75rem;">${n.mean} / 7</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 0.75rem; font-weight: 600;">95% CI:</td>
                            <td style="padding: 0.75rem;">[${n.ci95Lower}, ${n.ci95Upper}]</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 0.75rem; font-weight: 600;">Std Deviation:</td>
                            <td style="padding: 0.75rem;">${n.stdDev}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 0.75rem; font-weight: 600;">Range:</td>
                            <td style="padding: 0.75rem;">${n.min} - ${n.max}</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.75rem; font-weight: 600;">Agreement:</td>
                            <td style="padding: 0.75rem;">${n.agreement}%</td>
                        </tr>
                    </table>
                    <p style="font-size: 0.85rem; color: #6b7280; margin-top: 1rem; margin-bottom: 0;">
                        <strong>What this means:</strong> ${parseInt(n.agreement)>70?"High agreement among participants - ratings are consistent.":parseInt(n.agreement)>40?"Moderate agreement - some variation in ratings.":"Low agreement - participants have quite different opinions about this study."}
                    </p>
                </div>
            `,e.classList.add("active")};window.closeStudyModal=function(){document.getElementById("studyModal").classList.remove("active")};function X(t){L=t}
