import"./modulepreload-polyfill-B5Qt9EMX.js";import{o as h,g as b,G as w,s as v,a as i,b as E,c as I,d as s}from"./firebase-config-DPyDLBpP.js";import{r as l,a as p,g as c}from"./firebase-QsoZ-6oB.js";h(i,e=>{e?(A(),g()):k()});b(i).then(e=>{if(e){const t=document.getElementById("login-error");t&&(t.style.display="none")}}).catch(e=>{const t=document.getElementById("login-error");t&&(t.textContent=`Login failed: ${e.message}`,t.style.display="block")});window.loginWithGoogle=async function(){const e=document.getElementById("login-error"),t=new w;try{await v(i,t),e.style.display="none"}catch(n){if(n.code==="auth/popup-blocked"||n.code==="auth/cancelled-popup-request")try{await E(i,t)}catch(o){e.textContent=`Login failed: ${o.message}. Please ensure pop-ups are allowed and try again.`,e.style.display="block"}else if(n.code!=="auth/popup-closed-by-user"){let o=n.message;n.code==="auth/unauthorized-domain"?o="This domain is not authorized. Please add it in Firebase Console > Authentication > Settings > Authorized domains.":n.code==="auth/operation-not-allowed"?o="Google Sign-In is not enabled. Please enable it in Firebase Console > Authentication > Sign-in method.":n.code==="auth/invalid-api-key"&&(o="Invalid API key. Please check your Firebase configuration."),e.textContent=`Login failed: ${o}`,e.style.display="block"}}};window.logoutAdmin=async function(){await I(i)};function k(){document.getElementById("login-section").style.display="block",document.getElementById("admin-panel").style.display="none"}function A(){document.getElementById("login-section").style.display="none",document.getElementById("admin-panel").style.display="block"}async function g(){try{const e=l(s,"active"),t=await c(e),n=t.exists()?Object.keys(t.val()).length:0;document.getElementById("active-count").textContent=n;const o=l(s,"ratings"),d=await c(o);let u=0;if(d.exists()){const m=d.val();Object.values(m).forEach(f=>{u+=Object.keys(f).length})}document.getElementById("total-ratings").textContent=u;const r=l(s,"leaderboard"),a=await c(r),y=a.exists()?Object.keys(a.val()).length:0;document.getElementById("leaderboard-count").textContent=y}catch(e){console.error("Error loading stats:",e)}}window.stopAllSessions=async function(){if(!confirm("Are you sure you want to stop all active sessions? This will force all participants to start new sessions."))return;const e=document.getElementById("action-result");e.innerHTML='<p style="color: #f59e0b;">⏳ Stopping all sessions...</p>';try{const t=l(s,"active");await p(t),e.innerHTML='<p style="color: #10b981; padding: 1rem; background: #d1fae5; border-radius: 4px;">✅ All active sessions have been stopped successfully.</p>',await g()}catch(t){e.innerHTML=`<p style="color: #ef4444; padding: 1rem; background: #fef2f2; border-radius: 4px;">❌ Error: ${t.message}</p>`}};window.deleteAllRatings=async function(){const e=l(s,"ratings"),t=await c(e);if(!t.exists()){alert("ℹ️ No ratings data to delete.");return}const n=t.val();let o=0;Object.values(n).forEach(a=>{o+=Object.keys(a).length});const d=`⚠️ WARNING: You are about to permanently delete ${o} rating(s) across all studies.

This action CANNOT be undone!

Type "DELETE" to confirm:`;if(prompt(d)!=="DELETE"){alert("❌ Deletion cancelled.");return}const r=document.getElementById("delete-result");r.innerHTML='<p style="color: #f59e0b;">⏳ Deleting all ratings data...</p>';try{await p(e),r.innerHTML='<p style="color: #10b981; padding: 1rem; background: #d1fae5; border-radius: 4px;">✅ All ratings data has been permanently deleted.</p>',await g()}catch(a){r.innerHTML=`<p style="color: #ef4444; padding: 1rem; background: #fef2f2; border-radius: 4px;">❌ Error: ${a.message}</p>`}};window.auth=i;window.database=s;
